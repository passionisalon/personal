<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="org.zerock.myapp.mapper.TravelMapper">
  	
  	
  <sql id="searchType">
  	<trim prefix="(" suffix=")" prefixOverrides="OR">
  		<trim prefix="AND">
  			<if test='searchType != ""'>
  				category = #{searchType}
  			</if>
  			<if test='keyword !="" AND !keyword.isEmpty()'>
  				title LIKE '%' || #{keyword} || '%'
 			</if>
  		</trim>
  	</trim>
  </sql>
  
  	
  	<select id="getTravelList" resultType="org.zerock.myapp.domain.TravelDTO">
  		SELECT *
  		FROM tbl_travel
  		WHERE 
  			title LIKE '%' || #{keyword} || '%'
  			AND
  			category LIKE '%' || #{searchType} || '%'
  		ORDER BY
  			seq DESC
  		OFFSET (#{currPage} - 1) * #{amount} ROWS
  		FETCH NEXT #{amount} ROWS ONLY 
  	</select>
  	
  	<select id="getSelectTravel" resultType="org.zerock.myapp.domain.TravelDTO">
  		SELECT *
  		FROM tbl_travel
  		WHERE seq = #{seq}
  	</select>
  	
  	<select id="getPageTotalAmount" resultType="java.lang.Integer">
  		SELECT
  			count(*)
  		FROM 
  			tbl_travel
  		WHERE
  			1=1
  	</select>
  	
  	<insert id="travelInsert">
  		INSERT INTO
  			tbl_travel
  		(
  			seq,
  			writer,
  			category,
  			title,
  			content,
  			address,
  			total,
  			write_date,
  			modify_date
  		)
  		VALUES 
  		(
  			#{seq},
  			#{writer},
  			#{category},
  			#{title},
  			#{content},
  			#{address},
  			#{total},
  			#{write_date},
  			#{modify_date}
  		)
  			
  	</insert>
  	
  	<select id="SearchTravelList" resultType="org.zerock.myapp.domain.TravelDTO">
  		
  		SELECT *
  		FROM 
  		(
  			SELECT 
  				/*+ INDEX_DESC(tbl_travel PK_board) */
  				*
  			FROM
  				tbl_travel
  			WHERE
  				<include refid="searchType"></include>
  				1=1
  			ORDER BY
  			  	OFFSET (#{currPage} - 1) * #{amount} ROWS
  				FETCH NEXT #{amount} ROWS ONLY 
  		)
  			
  	</select>
  	
  	<select id="SearchTravelPage" resultType="java.lang.Integer">
  		  		SELECT
  			count(*)
  		FROM 
  			tbl_travel
  		WHERE
			<include refid="searchType"></include>
  			1=1
  	</select>
  	
  </mapper>